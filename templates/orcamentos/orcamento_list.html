{% extends "base.html" %}

{% block content %}
<h2>Or√ßamentos</h2>

<a href="{% url 'clientes:orcamento_create' %}" class="btn btn-primary mb-3">
    Novo or√ßamento
</a>

{% if object_list %}
<table class="table table-hover align-middle">
    <thead>
        <tr>
            <th>#</th>
            <th>Cliente</th>
            <th>Data</th>
            <th>Status</th>
            <th class="text-end">Valor</th>
            <th class="text-center">A√ß√µes</th>
        </tr>
    </thead>
    <tbody>
        {% for orcamento in object_list %}
        <tr>
            <td>
                <a href="{% url 'clientes:orcamento_detail' orcamento.id %}">
                    #{{ orcamento.id }}
                </a>
            </td>

            <td>{{ orcamento.cliente }}</td>

            <td>{{ orcamento.data|date:"d/m/Y" }}</td>

<td>
    <form method="post" action="{% url 'clientes:orcamento_list' %}">
        {% csrf_token %}
        <input type="hidden" name="orcamento_id" value="{{ orcamento.id }}">

        <select name="status"
                class="form-select form-select-sm"
                onchange="this.form.submit()">

            <option value="rascunho"
                {% if orcamento.status == 'rascunho' %}selected{% endif %}>
                Rascunho
            </option>

            <option value="aprovado"
                {% if orcamento.status == 'aprovado' %}selected{% endif %}>
                Aprovado
            </option>

            <option value="rejeitado"
                {% if orcamento.status == 'rejeitado' %}selected{% endif %}>
                Rejeitado
            </option>
        </select>
    </form>
</td>


            <td class="text-end">
                R$ {{ orcamento.total_com_desconto|floatformat:2 }}
            </td>

            <td class="text-center">
                <div class="btn-group btn-group-sm">
                    <a href="{% url 'clientes:orcamento_detail' orcamento.id %}"
                       class="btn btn-outline-primary"
                       title="Editar">
                        ‚úèÔ∏è
                    </a>

                    <a href="{% url 'clientes:orcamento_print' orcamento.id %}"
                       class="btn btn-outline-secondary"
                       title="Imprimir"
                       target="_blank">
                        üñ®
                    </a>

                    <a href="{% url 'clientes:orcamento_delete' orcamento.id %}"
                       class="btn btn-outline-danger"
                       title="Excluir"
                       onclick="return confirm('Excluir este or√ßamento?')">
                        üóë
                    </a>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>Nenhum or√ßamento criado.</p>
{% endif %}

{% endblock %}